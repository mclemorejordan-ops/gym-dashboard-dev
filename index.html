<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f17" />

  <!-- iOS Add to Home Screen -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Gym Dashboard" />

  <title>Gym Dashboard</title>

  <!-- Chart.js (we'll use later in Progress/Weight) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg: #0b0f17;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --hair: rgba(255,255,255,.10);

      --accent: #7c5cff;
      --good: #37d67a;
      --warn: #ffd166;
      --bad: #ff5c7a;

      --r: 18px;
      --shadow: 0 18px 40px rgba(0,0,0,.45);

      --navH: 78px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 700px at 20% -10%, rgba(124,92,255,.24), transparent 60%),
                  radial-gradient(900px 600px at 90% 10%, rgba(55,214,122,.14), transparent 55%),
                  var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
    }

    /* iOS safe areas */
    .app{
      min-height: 100%;
      padding: env(safe-area-inset-top) 14px calc(var(--navH) + env(safe-area-inset-bottom)) 14px;
      max-width: 780px;
      margin: 0 auto;
    }

    header{
      position: sticky;
      top: 0;
      z-index: 5;
      backdrop-filter: blur(16px);
      background: linear-gradient(to bottom, rgba(11,15,23,.88), rgba(11,15,23,.55));
      padding: 14px 0 10px 0;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 4px 2px 6px 2px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .brand .title{
      font-weight: 720;
      letter-spacing: .2px;
      font-size: 18px;
      line-height: 1.15;
    }
    .brand .subtitle{
      font-size: 12px;
      color: var(--muted);
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--hair);
      color: var(--text);
      font-size: 13px;
      user-select:none;
    }

    main{ padding-top: 10px; }

    .grid{
      display:grid;
      gap: 12px;
    }
    @media (min-width: 640px){
      .grid.cols2{ grid-template-columns: 1fr 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--hair);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .card h2{
      margin: 0 0 8px 0;
      font-size: 14px;
      letter-spacing: .3px;
      color: var(--muted);
      font-weight: 650;
      text-transform: uppercase;
    }

    .btnrow{ display:flex; gap: 10px; flex-wrap: wrap; }
    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 650;
      color: var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid var(--hair);
      user-select:none;
    }
    .btn.primary{
      background: linear-gradient(180deg, rgba(124,92,255,.95), rgba(124,92,255,.75));
      border-color: rgba(124,92,255,.35);
    }
    .btn:active{ transform: translateY(1px); }

    .muted{ color: var(--muted); }
    .kpi{
      display:flex;
      flex-direction:column;
      gap: 4px;
      padding: 10px 0 0 0;
    }
    .kpi .big{
      font-size: 22px;
      font-weight: 760;
      letter-spacing: .2px;
    }
    .kpi .small{
      font-size: 13px;
      color: var(--muted);
    }

    /* Bottom nav */
    .nav{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: calc(var(--navH) + env(safe-area-inset-bottom));
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom)) 10px;
      display:flex;
      justify-content:center;
      z-index: 50;
      pointer-events:none;
    }
    .navbar{
      width: min(780px, calc(100% - 18px));
      display:flex;
      justify-content:space-between;
      gap: 8px;
      background: rgba(16,20,30,.72);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 22px;
      padding: 8px;
      backdrop-filter: blur(18px);
      box-shadow: 0 18px 44px rgba(0,0,0,.55);
      pointer-events:auto;
    }
    .navbtn{
      flex: 1;
      appearance:none;
      border:none;
      background: transparent;
      color: var(--muted);
      padding: 10px 6px;
      border-radius: 16px;
      font-size: 11.5px;
      font-weight: 650;
      display:flex;
      flex-direction:column;
      gap: 6px;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
    }
    .navbtn .dot{
      width: 26px;
      height: 26px;
      border-radius: 10px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .navbtn.active{
      color: var(--text);
      background: rgba(124,92,255,.14);
      border: 1px solid rgba(124,92,255,.22);
    }
    .navbtn.active .dot{
      background: rgba(124,92,255,.22);
      border-color: rgba(124,92,255,.30);
    }

    /* Modal */
    .modalHost{
      position: fixed;
      inset: 0;
      display:none;
      align-items:flex-end;
      justify-content:center;
      z-index: 80;
      padding: 0 10px;
    }
    .modalHost.show{ display:flex; }
    .backdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
    }
    .sheet{
      position:relative;
      width: min(780px, 100%);
      max-height: 82vh;
      overflow:auto;
      background: rgba(16,20,30,.92);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px 22px 0 0;
      box-shadow: 0 22px 60px rgba(0,0,0,.65);
      padding: 14px;
      transform: translateY(10px);
    }
    .sheetHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      margin-bottom: 10px;
    }
    .sheetHeader .h{
      font-weight: 760;
      letter-spacing: .2px;
    }
    .xbtn{
      appearance:none;
      border:none;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="topbar">
        <div class="brand">
          <div class="title" id="appTitle">Gym Dashboard</div>
          <div class="subtitle" id="appSubtitle">Offline • Add to Home Screen • Local data</div>
        </div>
        <div class="chip" id="chipStatus">Not set up</div>
      </div>
    </header>

    <main id="viewRoot"></main>
  </div>

  <div class="nav">
    <div class="navbar" id="navbar"></div>
  </div>

  <!-- Modal Host -->
  <div class="modalHost" id="modalHost" aria-hidden="true">
    <div class="backdrop" id="modalBackdrop"></div>
    <div class="sheet" role="dialog" aria-modal="true">
      <div class="sheetHeader">
        <div class="h" id="modalTitle">Modal</div>
        <button class="xbtn" id="modalClose">Close</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <script>
    /********************
     * 1) State + Storage
     ********************/
    const STORAGE_KEY = "gymdash:v1";

    const DefaultState = () => ({
      schemaVersion: 1,
      createdAt: Date.now(),
      profile: null, // { name, proteinGoal, weekStartsOn, hideRestDays }
      routines: [],  // later
      activeRoutineId: null,
      exerciseLibrary: {
        weightlifting: [],
        cardio: [],
        core: []
      },
      logs: {
        workouts: [],   // later
        weight: [],     // { dateISO, weight }
        protein: []     // later
      },
      attendance: [] // list of dateISO trained
    });

    const Storage = {
      load(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(!raw) return DefaultState();
          const parsed = JSON.parse(raw);
          // Simple future-proofing:
          if(!parsed || typeof parsed !== "object") return DefaultState();
          if(!("schemaVersion" in parsed)) return DefaultState();
          return parsed;
        }catch(e){
          return DefaultState();
        }
      },
      save(state){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      },
      reset(){
        localStorage.removeItem(STORAGE_KEY);
      }
    };

    let state = Storage.load();

    /********************
     * 2) Tiny helpers
     ********************/
    const $ = (sel, root=document) => root.querySelector(sel);
    const el = (tag, attrs={}, children=[]) => {
      const n = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)){
        if(k === "class") n.className = v;
        else if(k === "text") n.textContent = v;
        else if(k.startsWith("on") && typeof v === "function") n.addEventListener(k.slice(2), v);
        else n.setAttribute(k, v);
      }
      children.forEach(c => n.appendChild(typeof c === "string" ? document.createTextNode(c) : c));
      return n;
    };

    const Dates = {
      todayISO(){
        const d = new Date();
        const y = d.getFullYear();
        const m = String(d.getMonth()+1).padStart(2,"0");
        const day = String(d.getDate()).padStart(2,"0");
        return `${y}-${m}-${day}`;
      }
    };

    /********************
     * 3) Modal
     ********************/
    const Modal = {
      open({ title, bodyNode }){
        $("#modalTitle").textContent = title || "Modal";
        const host = $("#modalHost");
        const body = $("#modalBody");
        body.innerHTML = "";
        if(bodyNode) body.appendChild(bodyNode);
        host.classList.add("show");
        host.setAttribute("aria-hidden","false");
      },
      close(){
        const host = $("#modalHost");
        host.classList.remove("show");
        host.setAttribute("aria-hidden","true");
        $("#modalBody").innerHTML = "";
      }
    };

    $("#modalClose").addEventListener("click", Modal.close);
    $("#modalBackdrop").addEventListener("click", Modal.close);

    /********************
     * 4) Router + Views
     ********************/
    const Routes = {
      home: { label: "Home" },
      routine: { label: "Routine" },
      log: { label: "Log" },
      progress: { label: "Progress" },
      more: { label: "More" }
    };

    let currentRoute = "home";

    function setChip(){
      const chip = $("#chipStatus");
      if(state.profile?.name){
        chip.textContent = `Hi, ${state.profile.name}`;
      }else{
        chip.textContent = "Not set up";
      }
    }

    function renderNav(){
      const nav = $("#navbar");
      nav.innerHTML = "";
      Object.entries(Routes).forEach(([key, r]) => {
        const btn = el("button", {
          class: "navbtn" + (key === currentRoute ? " active" : ""),
          onClick: () => navigate(key)
        }, [
          el("div", { class:"dot" }),
          el("div", { text: r.label })
        ]);
        nav.appendChild(btn);
      });
    }

    function navigate(routeKey){
      currentRoute = routeKey;
      renderNav();
      renderView();
    }

    function renderView(){
      setChip();
      const root = $("#viewRoot");
      root.innerHTML = "";

      // If not onboarded, we gently guide user (we'll implement onboarding next step)
      const needsOnboarding = !state.profile;

      if(needsOnboarding){
        root.appendChild(Views.OnboardingGate());
        return;
      }

      // Normal routes
      if(currentRoute === "home") root.appendChild(Views.Home());
      else if(currentRoute === "routine") root.appendChild(Views.Routine());
      else if(currentRoute === "log") root.appendChild(Views.Log());
      else if(currentRoute === "progress") root.appendChild(Views.Progress());
      else if(currentRoute === "more") root.appendChild(Views.More());
    }

    /********************
     * 5) Views (placeholders now)
     ********************/
    const Views = {
      OnboardingGate(){
        return el("div", { class:"grid" }, [
          el("div", { class:"card" }, [
            el("h2", { text:"Welcome" }),
            el("div", { class:"kpi" }, [
              el("div", { class:"big", text:"Let’s set up your Gym Dashboard" }),
              el("div", { class:"small", text:"Next step: create your profile and choose a routine template." })
            ]),
            el("div", { style:"height:12px" }),
            el("div", { class:"btnrow" }, [
              el("button", {
                class:"btn primary",
                onClick: () => {
                  Modal.open({
                    title: "Onboarding (Next Step)",
                    bodyNode: el("div", {}, [
                      el("div", { class:"muted", text:"We’ll build this screen next: profile + routine template picker." }),
                      el("div", { style:"height:12px" }),
                      el("button", { class:"btn primary", onClick: () => Modal.close() }, ["Got it"])
                    ])
                  });
                }
              }, ["Start setup"])
            ])
          ]),
          el("div", { class:"card" }, [
            el("h2", { text:"Data" }),
            el("div", { class:"muted", text:"Everything stays on your device (localStorage). Backup/Import comes later." }),
            el("div", { style:"height:12px" }),
            el("div", { class:"btnrow" }, [
              el("button", {
                class:"btn",
                onClick: () => {
                  Storage.reset();
                  state = Storage.load();
                  navigate("home");
                }
              }, ["Reset local data"])
            ])
          ])
        ]);
      },

      Home(){
        return el("div", { class:"grid cols2" }, [
          el("div", { class:"card" }, [
            el("h2", { text:"Today" }),
            el("div", { class:"kpi" }, [
              el("div", { class:"big", text:"Today’s workout" }),
              el("div", { class:"small", text:"(We’ll auto-generate this from your routine + weekday.)" })
            ]),
            el("div", { style:"height:12px" }),
            el("button", { class:"btn primary" }, ["Quick Check-In (coming)"])
          ]),
          el("div", { class:"card" }, [
            el("h2", { text:"Protein" }),
            el("div", { class:"kpi" }, [
              el("div", { class:"big", text:"Ring + grams left" }),
              el("div", { class:"small", text:"(Live updates while typing, for today.)" })
            ]),
            el("div", { style:"height:12px" }),
            el("button", { class:"btn" }, ["Add meals (coming)"])
          ]),
          el("div", { class:"card" }, [
            el("h2", { text:"Attendance" }),
            el("div", { class:"muted", text:"Weekly dots + tap check-in. Calendar view later." })
          ]),
          el("div", { class:"card" }, [
            el("h2", { text:"Next" }),
            el("div", { class:"muted", text:"We’ll build onboarding next so Home becomes fully functional." })
          ])
        ]);
      },

      Routine(){
        return el("div", { class:"grid" }, [
          el("div", { class:"card" }, [
            el("h2", { text:"Routine" }),
            el("div", { class:"muted", text:"Multiple routines: create/edit/duplicate/delete, rest days, template conversion." })
          ])
        ]);
      },

      Log(){
        return el("div", { class:"grid" }, [
          el("div", { class:"card" }, [
            el("h2", { text:"Log Sets" }),
            el("div", { class:"muted", text:"Weightlifting / Cardio / Core logging flows + PR tracking + history modal." })
          ])
        ]);
      },

      Progress(){
        return el("div", { class:"grid" }, [
          el("div", { class:"card" }, [
            el("h2", { text:"Progress" }),
            el("div", { class:"muted", text:"Table + Graph (Chart.js): Top Weight, Est. 1RM, Volume, Cardio, Core, export PNG." })
          ])
        ]);
      },

      More(){
        return el("div", { class:"grid" }, [
          el("div", { class:"card" }, [
            el("h2", { text:"More" }),
            el("div", { class:"muted", text:"Weight, Attendance, Backup/Import, Settings." })
          ]),
          el("div", { class:"card" }, [
            el("h2", { text:"Debug" }),
            el("div", { class:"btnrow" }, [
              el("button", {
                class:"btn",
                onClick: () => Modal.open({
                  title: "Current State (JSON)",
                  bodyNode: el("pre", { style:"white-space:pre-wrap; font-size:12px; color: rgba(255,255,255,.85);" }, [
                    JSON.stringify(state, null, 2)
                  ])
                })
              }, ["View state JSON"]),
              el("button", {
                class:"btn",
                onClick: () => {
                  Storage.reset();
                  state = Storage.load();
                  navigate("home");
                }
              }, ["Reset local data"])
            ])
          ])
        ]);
      }
    };

    /********************
     * 6) Boot
     ********************/
    renderNav();
    renderView();
  </script>
</body>
</html>
