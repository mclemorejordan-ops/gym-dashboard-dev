  // ✅ "Create new" option when typing
  if(rawQ){
    const exists = all.some(n => normExName(n) === normExName(rawQ));
    if(!exists){
      const create = document.createElement("div");
      create.className = "exPickItem";
      create.innerHTML = ""; // never inject rawQ into innerHTML

      const row = document.createElement("div");
      row.className = "exPickRow";

      if(exPickMulti){
        const chk = document.createElement("span");
        chk.className = "exPickCheck";
        chk.textContent = "+";
        row.appendChild(chk);
      }

      const label = document.createElement("span");
      label.textContent = `➕ Create "${rawQ}"`;
      row.appendChild(label);

      create.appendChild(row);

      // ✅ NEW: type toggle + (core) mode toggle + explicit Create button
      const metaRow = document.createElement("div");
      metaRow.style.display = "flex";
      metaRow.style.flexWrap = "wrap";
      metaRow.style.gap = "8px";
      metaRow.style.marginTop = "10px";
      metaRow.style.alignItems = "center";

      const typeWrap = document.createElement("label");
      typeWrap.style.display = "flex";
      typeWrap.style.alignItems = "center";
      typeWrap.style.gap = "8px";
      typeWrap.textContent = "Type";

      const typeSel = document.createElement("select");
      typeSel.innerHTML = `
        <option value="strength">Strength</option>
        <option value="cardio">Cardio</option>
        <option value="core">Core</option>
      `;
      typeWrap.appendChild(typeSel);

      const coreModeWrap = document.createElement("label");
      coreModeWrap.style.display = "none"; // only when type === core
      coreModeWrap.style.alignItems = "center";
      coreModeWrap.style.gap = "8px";
      coreModeWrap.textContent = "Core Mode";

      const coreModeSel = document.createElement("select");
      coreModeSel.innerHTML = `
        <option value="reps">Reps</option>
        <option value="time">Time</option>
      `;
      coreModeWrap.appendChild(coreModeSel);

      const createBtn = document.createElement("button");
      createBtn.className = "tap";
      createBtn.type = "button";
      createBtn.textContent = "Create";

      typeSel.addEventListener("change", ()=>{
        const t = String(typeSel.value || "strength").toLowerCase();
        coreModeWrap.style.display = (t === "core") ? "flex" : "none";
      });

      // Prevent clicking dropdowns from selecting the row
      [typeSel, coreModeSel].forEach(el=>{
        el.addEventListener("click", (e)=> e.stopPropagation());
      });

      createBtn.addEventListener("click", (e)=>{
        e.preventDefault();
        e.stopPropagation();

        const t = String(typeSel.value || "strength").toLowerCase();
        const cm = (t === "core")
          ? String(coreModeSel.value || "reps").toLowerCase()
          : null;

        const created = addCustomExercise(rawQ, t, cm);
        if(!created) return;

        if(exPickMulti){
          exPickSelectedSet.add(created);
          renderExercisePickerList();
          return;
        }

        exPickSelected = created;

        if(typeof exPickOnConfirm === "function"){
          exPickOnConfirm(exPickSelected);
        }

        closeExercisePicker();
      });

      metaRow.appendChild(typeWrap);
      metaRow.appendChild(coreModeWrap);
      metaRow.appendChild(createBtn);

      create.appendChild(metaRow);

      exPickList.appendChild(create);
    }
  }
